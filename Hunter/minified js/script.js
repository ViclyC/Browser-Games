const BUTTONFACTOR=.06,HITTINGTIME=2e3,IMGH=200,IMGW=200,POP=100,POPDELAY=100,GOODJOB=3,CAP=10,WONDERFUL=5,HPFACTOR=20,RANGE1=3,RANGE2=6,RANGE3=9,GAIN1=1,GAIN2=2,GAIN3=3,FULL=80;let height,width,centerY,centerX,num,timeReward,endButton=document.querySelector("#end"),scoreString=document.querySelector("#score").innerHTML,currentScore=0,audio=document.querySelector("#hammer"),bgm=document.querySelector("#bgm"),input=prompt("Choose how many units (an integer between 1 and 10)","1"),testInput=!1,pepeArr=new Array(num),isArr=new Array(num),timerArr=new Array(num),moveArr=new Array(num),hitArr=new Array(num),hp=0,gifArr=new Array(num),rewardMsg1=document.querySelector("#good"),rewardMsg2=document.querySelector("#wonder"),cheer=document.querySelector("#cheer"),miss=0,gain=0,startButton=document.querySelector("#start"),start=!1,red=document.querySelector("#red");cheer.src="images/cheer.gif",cheer.style.width=IMGW+"px",cheer.style.height=IMGH+"px",cheer.style.display="none",rewardMsg1.innerHTML="GOOD JOB!",rewardMsg2.innerHTML="WONDERFUL!",rewardMsg1.style.display="none",rewardMsg2.style.display="none",document.querySelector("#intro").innerHTML="The game has n units moving around. <br><br> Not hitting a unit before it moves loses you 1 hp. <br><br> Missing a click counts as a misclick. <br><br> You lose if your hp goes to 0 or if you reach 10 misclick.<br><br> You gain some hp back if you score a hit when n is between 4 and 10. <br><br> If you hit 3 or more at once you get a congrats message!",document.querySelector("#score").style.display="none",endButton.style.display="none",document.querySelector("#hp").style.display="none",document.querySelector("#miss").style.display="none",red.src="images/red.png",red.style.position="absolute",red.style.width="3vw",red.style.height=FULL+"vh",red.style.right="2vw",red.style.bottom="5vh",red.style.display="none";for(let e=1;e<=CAP;e++)if(e==input){testInput=!0,num=parseInt(input);break}for(;!testInput;){input=prompt("That's not a valid input, try again","1");for(let e=1;e<=CAP;e++)e==input&&(testInput=!0,num=parseInt(input))}function startGame(){start=!0,bgm.play(),bgm.loop=!0,red.style.display="inline",document.querySelector("#intro").style.display="none",document.querySelector("#score").style.display="block",document.querySelector("#score").innerHTML="SCORE: 0",endButton.style.display="inline",document.querySelector("#hp").style.display="block",document.querySelector("#miss").style.display="block",document.querySelector("#miss").innerHTML="MISCLICK: 0",startButton.style.display="none",endButton.style.display="inline"}function generate(){height=window.innerHeight-1,width=window.innerWidth-1,centerY=height/2-IMGH/2,centerX=width/2-IMGW/2;for(let e=0;e<num;e++)gifArr[e]="images/cry"+e+".gif",isArr[e]=!1,hitArr[e]=0,moveArr[e]=0==e?0:-1,pepeArr[e]=document.createElement("img"),pepeArr[e].src="images/pepe.png",pepeArr[e].width=IMGW,pepeArr[e].height=IMGH,pepeArr[e].style.position="absolute",pepeArr[e].style.top=centerY+"px",pepeArr[e].style.left=centerX+"px",pepeArr[e].style.cursor="url('images/aim.png'), pointer",document.getElementById("body").appendChild(pepeArr[e]),0!=e&&(pepeArr[e].style.display="none",setTimeout(function(){pepeArr[e].style.display="inline"},HITTINGTIME));hp=num*HPFACTOR,document.querySelector("#hp").innerHTML="HP: "+hp}function move(e){moveArr[e]++;let r=window.innerHeight-1,t=window.innerWidth-1,n=Math.random()*(r-IMGH-6*r*BUTTONFACTOR)+3*r*BUTTONFACTOR,o=Math.random()*(t-IMGW);pepeArr[e].src="images/pepe.png",pepeArr[e].style.top=n+"px",pepeArr[e].style.left=o+"px",moveArr[e]-hitArr[e]==1&&(hp--,red.style.height=FULL*(hp/(HPFACTOR*num))+"vh",hp<0&&(hp=0),document.querySelector("#hp").innerHTML="HP: "+hp,moveArr[e]=0,hitArr[e]=0)}function startMove(){for(let e=0;e<num;e++)timerArr[e]=setInterval(function(){move(e)},HITTINGTIME)}function handler(e){isArr[e]||(isArr[e]=!0,hit(e),clearInterval(timerArr[e]),timerArr[e]=setInterval(function(){move(e)},HITTINGTIME),setTimeout(function(){isArr[e]=!1},HITTINGTIME))}function hit(e){(hp+=gain)>=HPFACTOR*num&&(hp=HPFACTOR*num),red.style.height=FULL*(hp/(HPFACTOR*num))+"vh",document.querySelector("#hp").innerHTML="HP: "+hp,hitArr[e]++,pepeArr[e].src=gifArr[e],currentScore++,document.querySelector("#score").innerHTML="SCORE: "+currentScore,audio.pause(),audio.currentTime=0,audio.play()}function startHandler(){for(let e=0;e<num;e++)pepeArr[e].onclick=function(){handler(e)}}function reward(){let e=isArr.filter(Boolean).length;e>=GOODJOB&&e<WONDERFUL&&(rewardMsg1.style.display="block",cheer.style.display="inline",setTimeout(function(){rewardMsg1.style.display="none",cheer.style.display="none"},POPDELAY)),e>=WONDERFUL&&(cheer.src="images/poggie.gif",cheer.style.display="inline",rewardMsg2.style.display="block",setTimeout(function(){rewardMsg2.style.display="none",cheer.src="images/cheer.gif",cheer.style.display="none"},POPDELAY)),hp<=0&&lose()}function check(e){"IMG"==e.target.tagName&&"cheer"!=e.target.id&&"red"!=e.target.id||"BUTTON"==e.target.tagName||!start||(miss++,document.querySelector("#miss").innerHTML="MISCLICK: "+miss,miss>=CAP&&lose())}function startReward(){timeReward=setInterval(reward,POP)}function lose(){document.querySelector("html").style.backgroundImage="url('images/defeat.png')";for(let e=0;e<num;e++)pepeArr[e].style.display="none";cheer.style.display="none",rewardMsg1.style.display="none",rewardMsg2.style.display="none",red.style.display="none",document.querySelector("#miss").style.display="none",document.querySelector("#hp").style.display="none",document.querySelector("#score").innerHTML="YOU LOST ! <br> <br> Total Score: "+currentScore,clearInterval(timeReward);for(let e=0;e<num;e++)clearInterval(timerArr[e])}function press(){location.reload()}num>3&&num<=6&&(gain=1),num>6&&num<=9&&(gain=2),num>9&&(gain=3),startButton.addEventListener("click",generate),startButton.addEventListener("click",startMove),startButton.addEventListener("click",startHandler),startButton.addEventListener("click",startReward),startButton.addEventListener("click",startGame),document.body.addEventListener("click",check),endButton.onclick=press;